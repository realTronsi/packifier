!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Packifier=t():e.Packifier=t()}(this,(()=>(()=>{"use strict";var e={d:(t,i)=>{for(var r in i)e.o(i,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:i[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{Packifier:()=>i});class i{constructor(e){this.id=e.id,this.req=e.req,this.pre=e.pre,this.reqlen=this.req.length,this.prelen=this.pre.length,this.segmentationThreshold=e.segmentationThreshold,this.maxUnpackIterations=Math.ceil(this.prelen/this.segmentationThreshold)}pack(e,t){const i=this.req,r=this.pre,s=this.reqlen,n=this.prelen,o=[this.id];let h=0;do{o.push(e[i[h]])}while(++h<s);if(0===n)return pack;h=0;const l=this.segmentationThreshold;let p=0,a=o.length,c=0;o[a]=p;do{c===l&&(c=0,o[a]=p,p=0,a=o.length,o[a]=p);const i=r[h];!0===t[i]&&(o.push(e[i]),p|=1<<c),++c}while(++h<n);return o[a]=p,0===o[a]&&o.pop(),o}unpack(e){const t=this.req,i=this.pre,r=this.reqlen,s=this.prelen,n=(e.length,{});let o=0;for(;o++<r;)n[t[o-1]]=e[o];if(0===s)return n;const h=this.segmentationThreshold,l=this.maxUnpackIterations;let p=0;for(o=r;o++;){let t=e[o];if(void 0===t||o>l)break;let r=0;do{0!=(t&1<<r)&&(n[i[p]]=e[++o])}while(r++<h&&++p)}return n}}return t.Packifier})()));